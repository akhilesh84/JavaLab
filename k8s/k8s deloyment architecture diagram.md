# Kubernetes Deployment Architecture

## System Overview

```text
┌───────────────────────────────────────────────────────────────────┐
│                     Namespace: k8slab-ns                          │
└───────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────┐
│                       External Access                          │
│                                                                │
│   ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│   │  LB      │  │  LB      │  │  LB      │  │  LB      │       │
│   │  :8080   │  │  :8080   │  │  :9090   │  │  :3000   │       │
│   │ KafkaUI  │  │ WebAPI   │  │  Prom    │  │ Grafana  │       │
│   └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘       │
└────────┼─────────────┼─────────────┼─────────────┼─────────────┘
         │             │             │             │
┌────────▼─────────────▼─────────────▼─────────────▼─────────────┐
│                      Services Layer                            │
│                                                                │
│   ┌─────────────┐  ┌──────────────┐  ┌───────────┐  ┌────────┐ │
│   │ kafka-ui    │  │ webapi-svc   │  │ prom-svc  │  │grafana │ │
│   │  :8080      │  │ :8080, :8889 │  │  :9090    │  │ :3000  │ │
│   └──────┬──────┘  └───────┬──────┘  └─────┬─────┘  └───┬────┘ │
│          │                 │               │            │      │
│   ┌──────▼──────┐          │         ┌─────▼─────┐      │      │
│   │kafka-svc    │          │         │ Prometheus│◄─────┘      │
│   │  :9092      │          │         └───────────┘             │
│   └──────┬──────┘          │                                   │
└──────────┼─────────────────┼───────────────────────────────────┘
           │                 │
┌──────────▼─────────────────▼───────────────────────────────────┐
│                        Pods Layer                              │
│                                                                │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │            WebAPI Pod (Replica 1 & 2)                     │ │
│  │  ┌────────────────┐  ┌────────────────────────────────┐   │ │
│  │  │  WebAPI        │  │  OTel Collector Sidecar        │   │ │
│  │  │  Container     │  │                                │   │ │
│  │  │                │  │  Receivers:                    │   │ │
│  │  │  Spring Boot   │  │  - OTLP gRPC  :4317            │   │ │
│  │  │  App           │──┼─►- OTLP HTTP  :4318            │   │ │
│  │  │                │  │                                │   │ │
│  │  │  Telemetry:    │  │  Processors:                   │   │ │
│  │  │  - Traces   ───┼──┼─►- batch                       │   │ │
│  │  │  - Metrics  ───┼──┼─►- memory_limiter              │   │ │
│  │  │  - Logs     ───┼──┼─►                              │   │ │
│  │  │                │  │  Exporters:                    │   │ │
│  │  │  Env:          │  │  - logging (debug)             │   │ │
│  │  │  OTEL_EXPORTER │  │  - prometheus :8889            │   │ │
│  │  │  _OTLP_        │  │                                │   │ │
│  │  │  ENDPOINT=     │  │  Volume:                       │   │ │
│  │  │  localhost:    │  │  /conf/otel-collector-         │   │ │
│  │  │  4318          │  │  config.yaml                   │   │ │
│  │  │                │  │                                │   │ │
│  │  │  Port: :8080   │  │  Ports: :4317, :4318, :8889    │   │ │
│  │  └────────────────┘  └────────────────────────────────┘   │ │
│  │                                                           │ │
│  │  Shared Network: localhost                                │ │
│  │  ConfigMap: otel-collector-config                         │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                    Kafka Pod                             │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Kafka Broker                                      │  │  │
│  │  │  - Port: 9092                                      │  │  │
│  │  │  - Message storage                                 │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                   Kafka UI Pod                           │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Kafka UI                                          │  │  │
│  │  │  - Port: 8080                                      │  │  │
│  │  │  - Connects to: kafka-service:9092                 │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                  Prometheus Pod                          │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Prometheus Server                                 │  │  │
│  │  │  - Port: 9090                                      │  │  │
│  │  │  - Scrapes: webapi-service:8889                    │  │  │
│  │  │  - ConfigMap: prometheus-config                    │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                    Grafana Pod                           │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Grafana Dashboard                                 │  │  │
│  │  │  - Port: 3000                                      │  │  │
│  │  │  - Data Source: prometheus-service:9090            │  │  │
│  │  │  - Credentials: admin/admin                        │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────────────────┘
```text